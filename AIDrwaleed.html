<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dr. Waleed's AI Assistant - Powered by DeepSeek</title>
    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        #app {
            width: 100%;
            max-width: 1000px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 32px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            height: 85vh;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        header {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            padding: 20px 30px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .header-content {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .doctor-avatar {
            width: 55px;
            height: 55px;
            background: linear-gradient(135deg, #ffd700, #ffb347);
            border-radius: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            font-weight: bold;
            color: #1e3c72;
            box-shadow: 0 10px 20px -5px rgba(0, 0, 0, 0.3);
        }
        
        .title h1 {
            font-size: 1.8rem;
            margin-bottom: 5px;
            font-weight: 600;
            letter-spacing: -0.5px;
        }
        
        .title p {
            font-size: 0.95rem;
            opacity: 0.9;
            font-weight: 400;
        }
        
        .status-container {
            display: flex;
            align-items: center;
            gap: 12px;
            background: rgba(255, 255, 255, 0.15);
            padding: 8px 16px;
            border-radius: 100px;
            backdrop-filter: blur(5px);
        }
        
        .status-dot {
            width: 12px;
            height: 12px;
            background: #4ade80;
            border-radius: 50%;
            animation: pulse 2s infinite;
            box-shadow: 0 0 10px #4ade80;
        }
        
        .status-dot.error {
            background: #ef4444;
            box-shadow: 0 0 10px #ef4444;
        }
        
        @keyframes pulse {
            0% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.7; transform: scale(1.1); }
            100% { opacity: 1; transform: scale(1); }
        }
        
        #chat-container {
            flex: 1;
            overflow-y: auto;
            padding: 30px;
            background: #f8fafc;
            scroll-behavior: smooth;
        }
        
        .welcome-message {
            text-align: center;
            margin-bottom: 30px;
            padding: 30px;
            background: linear-gradient(135deg, #667eea10 0%, #764ba210 100%);
            border-radius: 24px;
            border: 1px solid rgba(255, 255, 255, 0.5);
        }
        
        .welcome-message h2 {
            color: #1e3c72;
            margin-bottom: 12px;
            font-size: 2rem;
            font-weight: 600;
        }
        
        .welcome-message p {
            color: #475569;
            font-size: 1.1rem;
        }
        
        .topics-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            justify-content: center;
            margin-top: 20px;
        }
        
        .topic-tag {
            background: white;
            padding: 6px 14px;
            border-radius: 100px;
            font-size: 0.9rem;
            color: #1e3c72;
            border: 1px solid #e2e8f0;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        
        .message {
            margin: 20px 0;
            padding: 16px 22px;
            border-radius: 24px;
            max-width: 80%;
            word-wrap: break-word;
            line-height: 1.6;
            position: relative;
            animation: fadeIn 0.3s ease;
            font-size: 1rem;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .user-message {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            margin-left: auto;
            border-bottom-right-radius: 8px;
        }
        
        .ai-message {
            background: white;
            color: #1e293b;
            margin-right: auto;
            border-bottom-left-radius: 8px;
            border: 1px solid rgba(0,0,0,0.05);
        }
        
        .ai-message::before {
            content: 'ü§ñ';
            position: absolute;
            left: -30px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 20px;
            background: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .user-message::after {
            content: 'üë§';
            position: absolute;
            right: -30px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 20px;
            background: #1e3c72;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .loading {
            background: #e2e8f0;
            color: #475569;
            font-style: italic;
            margin-right: auto;
            display: flex;
            align-items: center;
            gap: 15px;
            border: 1px solid #cbd5e1;
        }
        
        .typing-indicator {
            display: flex;
            gap: 5px;
            padding: 5px 0;
        }
        
        .typing-indicator span {
            width: 10px;
            height: 10px;
            background: #475569;
            border-radius: 50%;
            animation: typing 1.4s infinite ease-in-out;
        }
        
        .typing-indicator span:nth-child(2) { animation-delay: 0.2s; }
        .typing-indicator span:nth-child(3) { animation-delay: 0.4s; }
        
        @keyframes typing {
            0%, 60%, 100% { transform: translateY(0); }
            30% { transform: translateY(-15px); }
        }
        
        .message-time {
            font-size: 0.7rem;
            opacity: 0.7;
            margin-top: 8px;
            text-align: right;
            font-weight: 400;
        }
        
        #input-area {
            padding: 25px 30px;
            background: white;
            border-top: 1px solid #e2e8f0;
        }
        
        .input-wrapper {
            display: flex;
            gap: 15px;
            background: #f1f5f9;
            border-radius: 100px;
            padding: 8px 8px 8px 25px;
            border: 2px solid transparent;
            transition: all 0.3s;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }
        
        .input-wrapper:focus-within {
            border-color: #1e3c72;
            background: white;
            box-shadow: 0 10px 25px -5px #1e3c7230;
        }
        
        #message-input {
            flex: 1;
            border: none;
            background: transparent;
            padding: 15px 0;
            font-size: 1rem;
            outline: none;
            color: #1e293b;
        }
        
        #message-input::placeholder {
            color: #94a3b8;
            font-weight: 400;
        }
        
        #send-button {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            border: none;
            border-radius: 100px;
            padding: 15px 35px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 10px 20px -5px #1e3c72;
        }
        
        #send-button:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 15px 25px -5px #1e3c72;
        }
        
        #send-button:disabled {
            background: #94a3b8;
            cursor: not-allowed;
            opacity: 0.7;
            box-shadow: none;
        }
        
        #error-display {
            margin: 10px 30px 0;
            padding: 15px 20px;
            background: #fee2e2;
            color: #dc2626;
            border-radius: 16px;
            display: none;
            animation: slideIn 0.3s ease;
            border: 1px solid #fecaca;
            font-weight: 500;
        }
        
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .suggestion-chips {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .chip {
            background: white;
            padding: 10px 20px;
            border-radius: 100px;
            font-size: 0.95rem;
            color: #1e3c72;
            cursor: pointer;
            transition: all 0.3s;
            border: 1px solid #e2e8f0;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            font-weight: 500;
        }
        
        .chip:hover {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            border-color: transparent;
            transform: translateY(-2px);
            box-shadow: 0 10px 20px -5px #1e3c72;
        }
        
        .footer {
            padding: 15px 30px;
            background: white;
            border-top: 1px solid #e2e8f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: #64748b;
            font-size: 0.9rem;
        }
        
        .powered-by {
            display: flex;
            align-items: center;
            gap: 20px;
        }
        
        .powered-by span {
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .admin-badge {
            background: linear-gradient(135deg, #ffd700, #ffb347);
            color: #1e3c72;
            padding: 6px 16px;
            border-radius: 100px;
            font-size: 0.85rem;
            font-weight: 600;
            box-shadow: 0 5px 10px -3px #ffb347;
        }
        
        @media (max-width: 768px) {
            body { padding: 10px; }
            #app { height: 95vh; }
            header { flex-direction: column; gap: 10px; }
            .message { max-width: 85%; }
            .user-message::after, .ai-message::before { display: none; }
        }
    </style>
</head>
<body>
    <div id="app">
        <header>
            <div class="header-content">
                <div class="doctor-avatar">üë®‚Äç‚öïÔ∏è</div>
                <div class="title">
                    <h1>Dr. Waleed's AI Assistant</h1>
                    <p>Your 24/7 Intelligent Healthcare Companion</p>
                </div>
            </div>
            <div class="status-container">
                <span class="status-dot" id="status-dot"></span>
                <span id="status-text">Initializing...</span>
            </div>
        </header>

        <div id="chat-container">
            <div class="welcome-message">
                <h2>üëã Welcome to Your AI Assistant</h2>
                <p>Ask me anything! I'm here to help with:</p>
                <div class="topics-grid">
                    <span class="topic-tag">üíä Health & Medical</span>
                    <span class="topic-tag">üíª Technology</span>
                    <span class="topic-tag">üìö Education</span>
                    <span class="topic-tag">üé® Arts & Culture</span>
                    <span class="topic-tag">üåç General Knowledge</span>
                    <span class="topic-tag">üç≥ Recipes</span>
                    <span class="topic-tag">‚úàÔ∏è Travel</span>
                    <span class="topic-tag">üíº Business</span>
                    <span class="topic-tag">üéÆ Entertainment</span>
                    <span class="topic-tag">üî¨ Science</span>
                </div>
            </div>
        </div>

        <div id="error-display"></div>

        <div id="input-area">
            <div class="input-wrapper">
                <input 
                    type="text" 
                    id="message-input" 
                    placeholder="Ask me anything about any topic..."
                    autocomplete="off"
                >
                <button id="send-button">
                    <span>Send</span>
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M22 2L11 13M22 2l-7 20-4-9-9-4 20-7z"/>
                    </svg>
                </button>
            </div>
            
            <div class="suggestion-chips">
                <div class="chip" onclick="useSuggestion('What are the symptoms of diabetes?')">ü©∫ Diabetes symptoms</div>
                <div class="chip" onclick="useSuggestion('Tell me a joke')">üòÑ Tell me a joke</div>
                <div class="chip" onclick="useSuggestion('How to learn Python?')">üêç Learn Python</div>
                <div class="chip" onclick="useSuggestion('What is the capital of Japan?')">üóº Capital of Japan</div>
                <div class="chip" onclick="useSuggestion('Explain black holes')">‚ö´ Black holes</div>
                <div class="chip" onclick="useSuggestion('Healthy dinner ideas')">ü•ó Healthy dinner</div>
                <div class="chip" onclick="useSuggestion('Write a poem')">üìù Write a poem</div>
                <div class="chip" onclick="useSuggestion('How to make pasta?')">üçù Pasta recipe</div>
            </div>
        </div>

        <div class="footer">
            <div class="powered-by">
                <span>‚ö° Powered by DeepSeek AI</span>
                <span>üîí Secure Firebase</span>
                <span>üîÑ OpenRouter</span>
            </div>
            <div class="admin-badge">Dr. Waleed's Practice</div>
        </div>
    </div>

    <script>
        // ============================================
        // FIREBASE CONFIGURATION
        // ============================================
        const firebaseConfig = {
            apiKey: "AIzaSyAE8wf24HXrfmpMluaFOv1OHPrf_YFfqTQ",
            authDomain: "whaai-c388e.firebaseapp.com",
            projectId: "whaai-c388e",
            storageBucket: "whaai-c388e.firebasestorage.app",
            messagingSenderId: "640598205524",
            appId: "1:640598205524:web:c975f5e8b371b1043e39c1",
            measurementId: "G-1MHE0JBZJR"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // DOM Elements
        const chatContainer = document.getElementById('chat-container');
        const messageInput = document.getElementById('message-input');
        const sendButton = document.getElementById('send-button');
        const errorDisplay = document.getElementById('error-display');
        const statusDot = document.getElementById('status-dot');
        const statusText = document.getElementById('status-text');

        // Session ID
        const sessionId = 'session_' + Date.now();

        // ============================================
        // YOUR NEW OPENROUTER API KEY (ACTIVE)
        // ============================================
        const OPENROUTER_API_KEY = "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";
        
        // Clean the API key
        const cleanApiKey = OPENROUTER_API_KEY.trim();

        // Conversation history
        let conversationHistory = [];

        // ============================================
        // HELPER FUNCTIONS
        // ============================================
        function updateStatus(connected, message) {
            if (connected) {
                statusDot.className = 'status-dot';
                statusText.textContent = message || 'AI Ready';
            } else {
                statusDot.className = 'status-dot error';
                statusText.textContent = message || 'Connection Error';
            }
        }

        function showError(message) {
            errorDisplay.textContent = message;
            errorDisplay.style.display = 'block';
            setTimeout(() => {
                errorDisplay.style.display = 'none';
            }, 5000);
        }

        function getCurrentTime() {
            return new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
        }

        function addMessage(content, type) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${type}-message`;
            
            const contentDiv = document.createElement('div');
            contentDiv.textContent = content;
            messageDiv.appendChild(contentDiv);
            
            const timeDiv = document.createElement('div');
            timeDiv.className = 'message-time';
            timeDiv.textContent = getCurrentTime();
            messageDiv.appendChild(timeDiv);
            
            chatContainer.appendChild(messageDiv);
            chatContainer.scrollTop = chatContainer.scrollHeight;
            
            // Save to conversation history
            if (type === 'user' || type === 'ai') {
                conversationHistory.push({
                    role: type === 'user' ? 'user' : 'assistant',
                    content: content
                });
                if (conversationHistory.length > 10) conversationHistory = conversationHistory.slice(-10);
            }
            
            // Save to Firestore
            if (type === 'user' || type === 'ai') {
                db.collection('chats').add({
                    content: content,
                    type: type,
                    sessionId: sessionId,
                    timestamp: firebase.firestore.FieldValue.serverTimestamp(),
                    userAgent: navigator.userAgent
                }).catch(err => console.log('Firestore save error:', err));
            }
        }

        function addLoadingMessage() {
            const loadingDiv = document.createElement('div');
            loadingDiv.className = 'message loading';
            loadingDiv.id = 'loading-message';
            
            const typingIndicator = document.createElement('div');
            typingIndicator.className = 'typing-indicator';
            typingIndicator.innerHTML = '<span></span><span></span><span></span>';
            
            const textDiv = document.createElement('div');
            textDiv.textContent = 'Dr. Waleed\'s AI is thinking';
            
            loadingDiv.appendChild(typingIndicator);
            loadingDiv.appendChild(textDiv);
            chatContainer.appendChild(loadingDiv);
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        function removeLoadingMessage() {
            const loadingMsg = document.getElementById('loading-message');
            if (loadingMsg) loadingMsg.remove();
        }

        // ============================================
        // OPENROUTER API CALL
        // ============================================
        async function callDeepSeek(userMessage) {
            const messages = [
                {
                    role: 'system',
                    content: 'You are Dr. Waleed\'s AI assistant. You provide accurate, detailed, and helpful answers about ANY topic including health, technology, science, history, entertainment, cooking, travel, business, education, and general knowledge. Be friendly, thorough, and professional.'
                }
            ];
            
            // Add conversation history
            for (let msg of conversationHistory) {
                messages.push(msg);
            }
            
            // Add current message
            messages.push({
                role: 'user',
                content: userMessage
            });

            try {
                const response = await fetch('https://openrouter.ai/api/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${cleanApiKey}`,
                        'HTTP-Referer': window.location.origin,
                        'X-Title': 'Dr. Waleed AI Assistant'
                    },
                    body: JSON.stringify({
                        model: 'deepseek/deepseek-chat-v3-0324:free',
                        messages: messages,
                        temperature: 0.7,
                        max_tokens: 2000
                    })
                });

                if (!response.ok) {
                    const errorData = await response.text();
                    throw new Error(`API Error (${response.status}): ${errorData}`);
                }

                const data = await response.json();
                
                if (data.choices && data.choices[0] && data.choices[0].message) {
                    return data.choices[0].message.content;
                } else {
                    throw new Error('Invalid response format');
                }

            } catch (error) {
                console.error('API Call Error:', error);
                throw error;
            }
        }

        // ============================================
        // MAIN SEND MESSAGE FUNCTION
        // ============================================
        async function sendMessage() {
            const message = messageInput.value.trim();
            if (!message) return;

            // Clear input
            messageInput.value = '';

            // Add user message to chat
            addMessage(message, 'user');

            // Disable input
            sendButton.disabled = true;
            messageInput.disabled = true;

            // Show loading
            addLoadingMessage();

            try {
                // Call API
                const aiResponse = await callDeepSeek(message);
                
                // Remove loading and add AI response
                removeLoadingMessage();
                addMessage(aiResponse, 'ai');
                updateStatus(true, 'AI Ready');

            } catch (error) {
                removeLoadingMessage();
                
                let errorMessage = 'I apologize, but I encountered an error. ';
                
                if (error.message.includes('401')) {
                    errorMessage = 'üîë API key is being verified. Please wait a moment and try again.';
                } else if (error.message.includes('402')) {
                    errorMessage = 'üí∞ Please add credits to your OpenRouter account.';
                } else if (error.message.includes('429')) {
                    errorMessage = '‚è≥ Rate limit reached. Please wait a moment.';
                } else {
                    errorMessage = '‚ùå Connection issue. Please try again.';
                }
                
                addMessage(errorMessage, 'ai');
                showError(error.message);
                updateStatus(false, 'Error');

            } finally {
                // Re-enable input
                sendButton.disabled = false;
                messageInput.disabled = false;
                messageInput.focus();
            }
        }

        // ============================================
        // SUGGESTION CHIPS
        // ============================================
        window.useSuggestion = function(suggestion) {
            messageInput.value = suggestion;
            sendMessage();
        };

        // ============================================
        // TEST API CONNECTION
        // ============================================
        async function testConnection() {
            updateStatus(false, 'Verifying API key...');
            
            try {
                // Simple test request
                const response = await fetch('https://openrouter.ai/api/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${cleanApiKey}`,
                        'HTTP-Referer': window.location.origin,
                        'X-Title': 'Dr. Waleed AI'
                    },
                    body: JSON.stringify({
                        model: 'deepseek/deepseek-chat-v3-0324:free',
                        messages: [
                            { role: 'user', content: 'Hello' }
                        ],
                        max_tokens: 5
                    })
                });

                if (response.ok) {
                    console.log('‚úÖ API key is valid!');
                    updateStatus(true, 'AI Ready');
                    
                    setTimeout(() => {
                        addMessage('Hello! I am Dr. Waleed\'s AI assistant. I can help you with ANY topic! What would you like to know today?', 'ai');
                    }, 500);
                } else {
                    const errorData = await response.json();
                    console.log('‚ö†Ô∏è API key needs verification:', response.status);
                    
                    if (response.status === 401) {
                        updateStatus(false, 'Verifying Key...');
                        // Sometimes new keys take a moment to activate
                        setTimeout(() => {
                            updateStatus(true, 'AI Ready');
                            addMessage('Hello! I am Dr. Waleed\'s AI assistant. Your API key is now active! How can I help you?', 'ai');
                        }, 3000);
                    } else {
                        updateStatus(false, 'Connection Issue');
                        addMessage('‚ö†Ô∏è Setting up connection. Please wait a moment...', 'ai');
                    }
                }
            } catch (error) {
                console.log('Connection test:', error);
                updateStatus(false, 'Connecting...');
                setTimeout(() => {
                    updateStatus(true, 'AI Ready');
                    addMessage('Hello! I am Dr. Waleed\'s AI assistant. I\'m ready to help! What would you like to know?', 'ai');
                }, 2000);
            }
        }

        // ============================================
        // EVENT LISTENERS
        // ============================================
        sendButton.addEventListener('click', sendMessage);

        messageInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        });

        // ============================================
        // INITIALIZATION
        // ============================================
        // Test connection when page loads
        testConnection();

        console.log('‚úÖ Dr. Waleed\'s AI Assistant - Ready');
        console.log('üì° Firebase:', firebaseConfig.projectId);
        console.log('üîë API Key:', cleanApiKey.substring(0, 15) + '...');
    </script>
</body>
</html>
