<!DOCTYPE html>
<html>
<head>
    <title>My Website - Login with GitHub & Google</title>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    
    <style>
        body { font-family: Arial, sans-serif; max-width: 600px; margin: 50px auto; padding: 20px; }
        button { padding: 10px 20px; margin: 10px; font-size: 16px; cursor: pointer; }
        .login-btn { background: #4285f4; color: white; border: none; border-radius: 4px; }
        .github-btn { background: #333; color: white; border: none; border-radius: 4px; }
        .logout-btn { background: #dc3545; color: white; border: none; border-radius: 4px; }
        .user-info { background: #f8f9fa; padding: 20px; border-radius: 8px; margin: 20px 0; }
        .hidden { display: none; }
        .error { color: red; margin: 10px 0; }
    </style>
</head>
<body>
    <h1>üîê Firebase Authentication</h1>
    <div id="error-message" class="error hidden"></div>
    <p>Login with your GitHub or Google account</p>
    
    <!-- Login Buttons -->
    <div id="login-section">
        <button id="googleLogin" class="login-btn">Sign in with Google</button>
        <button id="githubLogin" class="github-btn">Sign in with GitHub</button>
    </div>
    
    <!-- User Info (shown after login) -->
    <div id="user-info" class="user-info hidden">
        <h2>Welcome, <span id="user-name"></span>!</h2>
        <p><strong>Email:</strong> <span id="user-email"></span></p>
        <p><strong>Provider:</strong> <span id="user-provider"></span></p>
        <p><img id="user-photo" src="" alt="Profile" style="width: 80px; border-radius: 50%;"></p>
        <button id="logout" class="logout-btn">Logout</button>
    </div>
    
    <script>
        // YOUR FIREBASE CONFIGURATION
        const firebaseConfig = {
            apiKey: "AIzaSyAE8wf24HXrfmpMluaFOv1OHPrf_YFfqTQ",
            authDomain: "whaai-c388e.firebaseapp.com",
            projectId: "whaai-c388e",
            storageBucket: "whaai-c388e.firebasestorage.app",
            messagingSenderId: "640598205524",
            appId: "1:640598205524:web:c975f5e8b371b1043e39c1",
            measurementId: "G-1MHE0JBZJR"
        };
        
        // Initialize Firebase
        try {
            firebase.initializeApp(firebaseConfig);
            console.log("‚úÖ Firebase initialized successfully");
        } catch (error) {
            console.error("‚ùå Firebase initialization error:", error);
            document.getElementById('error-message').textContent = 
                "Firebase error: " + error.message;
            document.getElementById('error-message').classList.remove('hidden');
        }
        
        const auth = firebase.auth();
        const db = firebase.firestore();
        
        // DOM Elements
        const googleLoginBtn = document.getElementById('googleLogin');
        const githubLoginBtn = document.getElementById('githubLogin');
        const logoutBtn = document.getElementById('logout');
        const loginSection = document.getElementById('login-section');
        const userInfoSection = document.getElementById('user-info');
        const userName = document.getElementById('user-name');
        const userEmail = document.getElementById('user-email');
        const userProvider = document.getElementById('user-provider');
        const userPhoto = document.getElementById('user-photo');
        const errorMessage = document.getElementById('error-message');
        
        // Google Login
        googleLoginBtn.addEventListener('click', () => {
            const provider = new firebase.auth.GoogleAuthProvider();
            provider.addScope('email');
            provider.addScope('profile');
            
            auth.signInWithPopup(provider)
                .then((result) => {
                    console.log('‚úÖ Google login successful:', result.user);
                    updateUI(result.user);
                    saveUserToFirestore(result.user);
                    errorMessage.classList.add('hidden');
                })
                .catch((error) => {
                    console.error('‚ùå Google login error:', error);
                    showError('Google login failed: ' + error.message);
                });
        });
        
        // GitHub Login
        githubLoginBtn.addEventListener('click', () => {
            const provider = new firebase.auth.GithubAuthProvider();
            provider.addScope('user:email');
            
            auth.signInWithPopup(provider)
                .then((result) => {
                    console.log('‚úÖ GitHub login successful:', result.user);
                    updateUI(result.user);
                    saveUserToFirestore(result.user);
                    errorMessage.classList.add('hidden');
                })
                .catch((error) => {
                    console.error('‚ùå GitHub login error:', error);
                    showError('GitHub login failed: ' + error.message);
                });
        });
        
        // Logout
        logoutBtn.addEventListener('click', () => {
            auth.signOut()
                .then(() => {
                    loginSection.classList.remove('hidden');
                    userInfoSection.classList.add('hidden');
                    console.log('‚úÖ Logged out successfully');
                })
                .catch((error) => {
                    console.error('‚ùå Logout error:', error);
                    showError('Logout failed: ' + error.message);
                });
        });
        
        // Save user to Firestore
        function saveUserToFirestore(user) {
            db.collection('users').doc(user.uid).set({
                uid: user.uid,
                email: user.email,
                displayName: user.displayName,
                photoURL: user.photoURL,
                provider: user.providerData[0].providerId,
                lastLogin: firebase.firestore.FieldValue.serverTimestamp(),
                createdAt: firebase.firestore.FieldValue.serverTimestamp()
            }, { merge: true })
            .then(() => console.log('‚úÖ User saved to Firestore'))
            .catch(error => console.error('‚ùå Error saving user:', error));
        }
        
        // Update UI after login
        function updateUI(user) {
            userName.textContent = user.displayName || user.email;
            userEmail.textContent = user.email;
            userProvider.textContent = user.providerData[0].providerId || 'Unknown';
            userPhoto.src = user.photoURL || 'https://via.placeholder.com/80';
            
            loginSection.classList.add('hidden');
            userInfoSection.classList.remove('hidden');
        }
        
        // Show error message
        function showError(message) {
            errorMessage.textContent = message;
            errorMessage.classList.remove('hidden');
        }
        
        // Check auth state on page load
        auth.onAuthStateChanged((user) => {
            if (user) {
                updateUI(user);
            } else {
                loginSection.classList.remove('hidden');
                userInfoSection.classList.add('hidden');
            }
        });
        
        // Test Firebase connection
        console.log("Testing Firebase connection...");
        console.log("Project ID:", firebaseConfig.projectId);
        console.log("Auth Domain:", firebaseConfig.authDomain);
    </script>
</body>
</html>
